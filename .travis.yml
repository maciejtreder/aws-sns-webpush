jobs:
  include:
  - stage: prepare
    language: java
    jdk: oraclejdk8
    before_install:
    - pip install --user awscli
    - export PATH=$PATH:$HOME/.local/bin
    - gem install push_package
    - push_package -w pushPackage.raw/website.json -i pushPackage.raw/icon.iconset
      -c src/main/resources/cert.p12 -p $SAFARI_KEY_PASSWORD
    - mv pushPackage.zip src/main/resources/web.com.maciejtreder.angular-universal-serverless.zip
    script: mvn clean package
    after_success:
    - aws s3 cp ./target/aws-sns-webpush-1.0-SNAPSHOT.jar s3://travis-mtr/aws-sns-webpush/
  - stage: deploy
    language: node_js
    node_js: node
    before_install:
    - pip install --user awscli
    - export PATH=$PATH:$HOME/.local/bin
    - aws s3 sync s3://travis-mtr/aws-sns-webpush/ ./target
    - npm install
    script: npm run serverless
env:
  global:
  - AWS_REGION: eu-central-1
  - secure: seB6H4tDqF74vbyP6d8Tkc6I3yMFooxqKbbg/3iIcpkidkO4QpLuxrYfTIRjP1NjfGbEtNwtksHiBoIBYs1yothi/2Q8AfnnYQhj7K+Ls6p7Ppt+eKil7/phAAWzBLo2gA4lS7J1DL0/PkI2HdjGbrHd0LTpUHG13BU8BjodAml1oDPlbDAda1E8v0Htt8dJerggZBSIuGGXL5r/YShRCbx3i8fAC0rakQAsuiX1FiXHA/W5ZdFuMEWZbZd3+K/HlVGmydlp6S2f1vwRpuKdozR6qeyykbWtcNDuLfWwZ2PQgtMMqeqG78CKY98aBSds7DgudxONdzuC7hVyIs12D/5R2IrmjSeHumRotJrqscnUeRC2b1NfAIvPm3c0y2hOfiZvT0Lzk8wGTE2Bx6DFKLk2nwivnoPOybVtp1kFEkjA4Fqv2k5KkPT4JJepfwXSZn2ofcLv1hzR00P0vMAdsBX7XnMm+8v6iSgSSYMXTWWf2dV6T/PhfAq1i37c2A3HYdAr3CV4dn5Yf0dT3uVligOr/OB7F8ugR3z8QkUsMoO2831Mp2C5ABFmCKsF1tViNVHu0FsVIXkBW0YemeSbOa2akf56FmKH/Ey+Yaz+8J/Zmmj4XdCyrY9QVWsARfb/jESvmi3B9valHSH/1uT8LGeumXxl0Wy+8tER5HdOlE0=
  - secure: BcoO0fTGpoRXP/VOQdLeFkTRvGE04bOL1QGs6YWyy3yRzyxhaKVSRkrsezqCiwlev7gYNbwRX79R3BMFRfozszLH0Az4MpV22yoHzP/Ez2pm2U1iQcIssFyRhbIYFj1NPX49nJo9VXx3i8BSsDZMebC/VPkeYo/8YpMniyHugBQsVBofN1Qz+EpOcEdNPvV4nSE4mZcziLsQbJfLYDS/GLIGeG4aI8vxKVUJhdwNR6rWxrddEFU+SR+OvBedsRrr3iU+WWpbl648ESRrCI3cTiSeO8cB2mOU0SnFv4r9S0Odoz+xMc6+OWgDkm2KbS1jpMzsMUyvOCV8PDnrLiKShSVmgI1Cz4LdraKZ+0aDwKteDBQlMWXcDuVCkrr0nl6HMhmzOZiw5LNtbed6mRC1dltZoUy7yyJz/OOsZsp15FAZY9H2wRwBpsrjvc3tS64r89kCoV/z0zyRMIJGAT259WZKLXwy8yLvVnKFgIQ4tJNrPDlj5j/S10EtoN3kWJsvZ+TAF0BgGoUia56tBcFkd0UZyyVILP/xfXVRSdL+KpfboLpc26btUVH0sTGjAukVF0cghgOERK/AQCshNAV0MvN9qbJMn7nETebQ04yD8KyExFSy9nc7Kl5zScTCqzgPbY6EfjSb7jNxkP80UFkjQwjrOoW5OMe4UfXx/FqL03c=
  - secure: u9nRNOqjWiJg6vOw1z7CcRDaN4gmiWDbJlFP/HSDw3QWpnJhQ/K9aHSkI8NLcbyWAW3mIrTVsnNsEO+qCS2XIvfoOaYQHDwpiPPH+tlo55DCrtbfV0hrE3ZKUhvX4vx9AeIlE8D0LvzpfVZHKMzZdBN3sC+qEDxJecBv+7zuMVRsqzfNAO1s2/X3NdeekoKOF0dje6OtRJ/TsG0HzuaHEu4Gsl/qgKvN40MHGPLfMZRNpTT4Jz3Xglry7hrcijcPlxsROr78iNNoGr50SFFkT3YZJbJdAksz4tRzlLEAexxsfXX2e33PTlXu2Z30scEfwaPFd0y3uCGm/FuCC1vkj4yZXPDVqFQ5WgQr3xT+lUks+XbSWSrR0flEX9ZxqNdvZ8FbmzA07l5rpAv9WfdK40VQ6+MHogDZRO0Oms5n3zrzjhxVNt8hR8pLWtxICYAwKJNiFSlHVji/Eo+3QhYmGPmXXzUge6KM+pOVCfJBETM67ytjn1fqVNyOzFw08w9ZyiJHRbgwjbTagsDhhJT9IdCHeDGYRU/7oJLkd/E4G8FqpxbkDyZTAz7oAeJfRU/MFkU3O6Z0RFThrt7M5Um1lKAIazlK3OIpZ2n40LhA3BLVpvHu8RKfDrMAwgV+bV+ya91HZ+g4EYo4Ky5WvVS5DodMBgh5WzhoL64ZJS3FJiQ=
  - secure: mDhxolsk01dIVS2ATDdK2nq+zdg3aElAsuK6RTph1Zmc1vpFVH7RftybJIYMOuwBU8k7Pt4HMRwm9U21c/J4BcK7wBHkB+ZF2s+i6aP3PwxjYmbsa0/WwsWopCPInYDDQSxeL1KK23qhzzDqTWdVm+KGsuyFN4nqFzUSotJEXkK5zRMoRDRCO1PwzQmfbQqrbic5CAk/fZm+pCiwgiNeK6qJipiOC90j7BOKoSWPPqCWU3jenJBAyDQsmotgbFOArgMHR8az3jfeoC/n73WoK0gh5XFR7oTQErI1BmGrSoDP1BQ/uU/0T+dXpIEUiibWMSs4bPn9B1ZeHjr1YVh+SPoWNTCN7WAkvpnIizM+s/26eFB41tgYJCOl6iJwbASHKdpUV7FcG2nKl0dk53FAmW8e76kqd0CDvg5/ZX0cC7bI5ARS4Kothm8Udh+edBufSWKopJ0+fXGmy5Rm7JwJ8AAEoYCJsejgWf5nobpYNYLYTNyC8sxPhy1XrFwDW74ExGjsT4imzXlCTXasILpMrOjA5C1bqJf6rIYruvWgqJTTig49Ik/gDQpXJspAmnJGNotV6ANR0ew4jkE4I1sHGjL21eA48yHj+c9s69+dtcv3eSUawCEkY8YmTwFCMFG2msAk9ya5JLI4fVVoLDvEhsdg8YZjKSpcsln4HUc3958=
  - secure: hXaS0BIdgVlZJlx0w9EY3nLxiK/WfjMxkyblJtoQ+OZHnBla01g5c02n2BjWWV4D/h/TZI9PfBw6YWxNJdcGPUsuGjgGKIKZH2KKgkPY0QEAjpd7S8NyozZhfkR6GyDnrv8kEIF7+M0rnm18M1q2k6Ws4+zcBcQEXq27uS6kOlatAUQSiCZCUyhMATcKSy8Mfd1kd8HBKHFejmUWJFOSNHakX4cQx5qQfHCoIjlGby3KzuSQnouP6irA6Xd8LLQQGH/WjcIOMf/f95n3eBciEAezfvN3GMbvdn9pIVs+B4HytEOIYcywn+GtnnAlS2ynr3MT8kF3DOF9Gz3ZFWVpH1g+GOmUzx2XKWYHr7PlYqXF4anGCFfdE71OLmGLsCsVLx2wxehOaf/Iqt9L0F2V0y7gBvvqTqxzHAh6GvpM0kTO6MYxTdwJ+z2niMGBK8t4oGSqBpbBtBMKDF6keEwd9RqUMgPvh9j6gqVb0yfpEmlDT7MbGIMi96vHo6Lxeh+qMNKRppQ+IrmfHyI/VJUKixFp2blb4LrmNfeZXv5BhtiE5VeogoNMVOxkeSoekaUILxB02Qeuka9vK57Y17pn+42yzTiwSxuwv9Bv+bDxLuMLWFCYr4+Nq/0sqRcLgsojUfaSgFhc50Jrey/ell5Jt8BfvZtk7iDUh3QaXSOA2nI=
