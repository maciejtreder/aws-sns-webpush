jobs:
  include:
  - stage: prepare
    language: java
    jdk: oraclejdk8
    before_install:
    - pip install --user awscli
    - export PATH=$PATH:$HOME/.local/bin
    - gem install push_package
    - push_package -w pushPackage.raw/website.json -i pushPackage.raw/icon.iconset
      -c src/main/resources/cert.p12 -p $SAFARI_KEY_PASSWORD
    - mv pushPackage.zip src/main/resources/web.com.maciejtreder.angular-universal-serverless.zip
    script: mvn clean package
    after_success:
    - aws s3 cp ./target/aws-sns-webpush-1.0-SNAPSHOT.jar s3://travis-mtr/aws-sns-webpush/
  - stage: deploy
    language: node_js
    node_js: node
    before_install:
    - pip install --user awscli
    - export PATH=$PATH:$HOME/.local/bin
    - aws s3 sync s3://travis-mtr/aws-sns-webpush/ ./target
    - npm install
    script: npm run serverless
env:
  global:
  - AWS_REGION: eu-central-1
  - secure: seB6H4tDqF74vbyP6d8Tkc6I3yMFooxqKbbg/3iIcpkidkO4QpLuxrYfTIRjP1NjfGbEtNwtksHiBoIBYs1yothi/2Q8AfnnYQhj7K+Ls6p7Ppt+eKil7/phAAWzBLo2gA4lS7J1DL0/PkI2HdjGbrHd0LTpUHG13BU8BjodAml1oDPlbDAda1E8v0Htt8dJerggZBSIuGGXL5r/YShRCbx3i8fAC0rakQAsuiX1FiXHA/W5ZdFuMEWZbZd3+K/HlVGmydlp6S2f1vwRpuKdozR6qeyykbWtcNDuLfWwZ2PQgtMMqeqG78CKY98aBSds7DgudxONdzuC7hVyIs12D/5R2IrmjSeHumRotJrqscnUeRC2b1NfAIvPm3c0y2hOfiZvT0Lzk8wGTE2Bx6DFKLk2nwivnoPOybVtp1kFEkjA4Fqv2k5KkPT4JJepfwXSZn2ofcLv1hzR00P0vMAdsBX7XnMm+8v6iSgSSYMXTWWf2dV6T/PhfAq1i37c2A3HYdAr3CV4dn5Yf0dT3uVligOr/OB7F8ugR3z8QkUsMoO2831Mp2C5ABFmCKsF1tViNVHu0FsVIXkBW0YemeSbOa2akf56FmKH/Ey+Yaz+8J/Zmmj4XdCyrY9QVWsARfb/jESvmi3B9valHSH/1uT8LGeumXxl0Wy+8tER5HdOlE0=
  - secure: BcoO0fTGpoRXP/VOQdLeFkTRvGE04bOL1QGs6YWyy3yRzyxhaKVSRkrsezqCiwlev7gYNbwRX79R3BMFRfozszLH0Az4MpV22yoHzP/Ez2pm2U1iQcIssFyRhbIYFj1NPX49nJo9VXx3i8BSsDZMebC/VPkeYo/8YpMniyHugBQsVBofN1Qz+EpOcEdNPvV4nSE4mZcziLsQbJfLYDS/GLIGeG4aI8vxKVUJhdwNR6rWxrddEFU+SR+OvBedsRrr3iU+WWpbl648ESRrCI3cTiSeO8cB2mOU0SnFv4r9S0Odoz+xMc6+OWgDkm2KbS1jpMzsMUyvOCV8PDnrLiKShSVmgI1Cz4LdraKZ+0aDwKteDBQlMWXcDuVCkrr0nl6HMhmzOZiw5LNtbed6mRC1dltZoUy7yyJz/OOsZsp15FAZY9H2wRwBpsrjvc3tS64r89kCoV/z0zyRMIJGAT259WZKLXwy8yLvVnKFgIQ4tJNrPDlj5j/S10EtoN3kWJsvZ+TAF0BgGoUia56tBcFkd0UZyyVILP/xfXVRSdL+KpfboLpc26btUVH0sTGjAukVF0cghgOERK/AQCshNAV0MvN9qbJMn7nETebQ04yD8KyExFSy9nc7Kl5zScTCqzgPbY6EfjSb7jNxkP80UFkjQwjrOoW5OMe4UfXx/FqL03c=
  - secure: LLs/x56fCXyVONvOqSU/fn6f0N7FGTer/fo3W4uMdl9U93Omy8ZJPmgKkVCkW3CgJVW8HrfjOD9R3DpeTQvepsm+TM+rs82fe1uIcOLD0omRpqwWJ9sbGeVTnkm6Oe99FRR4vhrY43kWLafs2MelD/t3+/V7A56kpbM1+Ez5wgkP6bPvr/l2+syo/XL0NtyZ5j71vK6wOXSajcEQXYJZLWiiDKzpaCgIpsu7etPcICQ4crR5eYl+K6s6sxdzy3IX4hu5i1Bu1+SqeTdc9ZpCc9VC0RZlBgF2DxxovDA338N67BgXwViYT96LPQDhiDaJ/hyQPmm2sZF314LU3QGGmFvqMREHKrp7lblwfq1TDxCNxfUgE0mT1tmuQvwg7yXUgnbyGOJWPX4/kmb2n2j5LoKXclSWnIhJo8Ic2D0Us8XcByzF3agFO/MpfuskzsiC0FP3SjsX9Hrvj1mxmWYLzlS9Me70CdUY6XrPj13wSbINiHVOK5tuMss2CV/A826L2WZ8/ALdi8m3Eq+5qhUMl7ktzMSUEaMa03RxCPAT6uvWOP2s4ngIm5naroZlWBkEkEcY3GDkgVXPpGPRLy5HCHf1ORx+92izFLsOB8sv2r035d3bjq1sMYVgDqdwO7wrDE4kmI3xLhtkrMcWONRIjHrXygI+E6FSwXF0df1LD1U=
  - secure: pJ9TjON/+KAhsbMoRYMEQ96o/5xq6bu1MYqK64wt2t5hfstqSjHcEXqO/KKHKPVEOhTC/WkYnkZH5U6wFSp6/+8LYIhwM4TL7B7HIUDhndLNjGJdb62q5pPtV/ADpMHOEckPVr5b/6TMotV+qZ8T9uPgUR5NZ0x1Rz1Yw1lNLsblZdBQLipdu3LFbg79ALB0MCG1aF8ZYjCWtts9aBEbETZocpdIsK3Kh7jVFOQRB1BAOPml2QjG0sYZEmlzz9IcHtuIQRt6pDy5Re6Q4y8sNcM6lopBx/VpaL/RAlpXlEB5ITJtKO/TorwdD4GapArLd7k9QKIqUlVO/x88lk6cJVWNbRa5+qa6xv79dLcLeccGqksHmwckzmrHmGoZMQtcWJ/c3CkNZKtq1hnTnPj2C9u0LTD/zl9/IAIZh6f1eG75POyPSoJi9rOOZebZhq1VXE6zd7RLVIxo0IVS6cZF1qL0sz2chCEvTxcJnbKR3DZM/70UkbGZy/ttNAybMpqzqsmUQ+4KapHIx4LGBTMV/cQqpoolZ/BHjpP3jSmnAsL0yEBsI1wkK7xdZpRZ8IpZLfQExP44o/W7KtzJREhaUVMt930yks9V4eTvK42XeYnq9EHSax8WEQipWsM5a6hnbz0WXYyDNrkm3v8g1XM2vjtEUe9MUh9XueQ9Bmldzio=
  - secure: u9nRNOqjWiJg6vOw1z7CcRDaN4gmiWDbJlFP/HSDw3QWpnJhQ/K9aHSkI8NLcbyWAW3mIrTVsnNsEO+qCS2XIvfoOaYQHDwpiPPH+tlo55DCrtbfV0hrE3ZKUhvX4vx9AeIlE8D0LvzpfVZHKMzZdBN3sC+qEDxJecBv+7zuMVRsqzfNAO1s2/X3NdeekoKOF0dje6OtRJ/TsG0HzuaHEu4Gsl/qgKvN40MHGPLfMZRNpTT4Jz3Xglry7hrcijcPlxsROr78iNNoGr50SFFkT3YZJbJdAksz4tRzlLEAexxsfXX2e33PTlXu2Z30scEfwaPFd0y3uCGm/FuCC1vkj4yZXPDVqFQ5WgQr3xT+lUks+XbSWSrR0flEX9ZxqNdvZ8FbmzA07l5rpAv9WfdK40VQ6+MHogDZRO0Oms5n3zrzjhxVNt8hR8pLWtxICYAwKJNiFSlHVji/Eo+3QhYmGPmXXzUge6KM+pOVCfJBETM67ytjn1fqVNyOzFw08w9ZyiJHRbgwjbTagsDhhJT9IdCHeDGYRU/7oJLkd/E4G8FqpxbkDyZTAz7oAeJfRU/MFkU3O6Z0RFThrt7M5Um1lKAIazlK3OIpZ2n40LhA3BLVpvHu8RKfDrMAwgV+bV+ya91HZ+g4EYo4Ky5WvVS5DodMBgh5WzhoL64ZJS3FJiQ=
